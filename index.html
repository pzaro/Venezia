<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Î’ÎµÎ½ÎµÏ„Î¯Î±: Dousis Guide & Audio</title>
    <style>
        /* --- CSS STYLES --- */
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: #f4f4f9; color: #333; margin: 0; padding-bottom: 60px; }
        
        /* Header & Filters */
        .header { background: white; position: sticky; top: 0; z-index: 900; box-shadow: 0 4px 6px rgba(0,0,0,0.05); padding: 10px 0; }
        h1 { text-align: center; color: #b71c1c; margin: 5px 0; font-size: 1.3rem; }
        
        .filters-wrapper { display: flex; flex-direction: column; gap: 8px; }
        .scroll-container { display: flex; overflow-x: auto; gap: 8px; padding: 0 15px; scrollbar-width: none; -webkit-overflow-scrolling: touch; }
        .scroll-container::-webkit-scrollbar { display: none; }
        
        .btn-filter { flex: 0 0 auto; padding: 8px 15px; border-radius: 20px; border: 1px solid #ddd; background: #f9f9f9; font-size: 0.85rem; color: #555; cursor: pointer; }
        .btn-filter.active { background: #b71c1c; color: white; border-color: #b71c1c; }
        .date-btn.active { background: #2c3e50; border-color: #2c3e50; }

        /* Cards */
        .container { max-width: 600px; margin: 0 auto; padding: 15px; }
        .card { background: white; border-radius: 12px; padding: 15px; margin-bottom: 15px; border-left: 5px solid #b71c1c; box-shadow: 0 2px 5px rgba(0,0,0,0.05); position: relative; }
        
        .category-tag { font-size: 0.75rem; font-weight: 700; text-transform: uppercase; color: #b71c1c; }
        .name { font-size: 1.2rem; font-weight: 800; margin: 5px 0; color: #222; }
        
        .meta-info { display: flex; gap: 10px; margin-top: 8px; font-size: 0.9rem; }
        .time-badge { background: #333; color: white; padding: 2px 6px; border-radius: 4px; font-weight: bold; font-size: 0.8rem; }
        .cost-badge { background: #e0f2f1; color: #00695c; padding: 2px 6px; border-radius: 4px; font-weight: bold; font-size: 0.8rem; }
        
        .tip { background: #fff8e1; color: #f57f17; padding: 8px; border-radius: 6px; margin-top: 10px; font-style: italic; font-size: 0.9rem; border-left: 3px solid #ffca28; }

        /* Buttons Container */
        .card-actions { display: flex; gap: 10px; margin-top: 12px; }
        .action-btn { flex: 1; padding: 10px; border-radius: 8px; text-align: center; font-weight: bold; text-decoration: none; font-size: 0.9rem; cursor: pointer; border: none; }
        
        .map-btn { background: white; color: #b71c1c; border: 2px solid #b71c1c; }
        .info-btn { background: #b71c1c; color: white; display: flex; align-items: center; justify-content: center; gap: 5px; }

        /* MODAL (Pop-up) */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 2000; align-items: flex-end; justify-content: center; }
        .modal-content { background: white; width: 100%; max-width: 600px; border-radius: 20px 20px 0 0; padding: 25px; box-sizing: border-box; max-height: 85vh; overflow-y: auto; animation: slideUp 0.3s ease-out; position: relative; }
        
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 10px; }
        .modal-title { font-size: 1.4rem; font-weight: bold; color: #b71c1c; margin: 0; }
        .close-btn { background: none; border: none; font-size: 2rem; color: #888; cursor: pointer; line-height: 1; }
        
        .modal-body { font-size: 1rem; line-height: 1.6; color: #444; white-space: pre-line; }
        
        .audio-controls { margin-top: 20px; display: flex; gap: 10px; border-top: 1px solid #eee; padding-top: 15px; }
        .speak-btn { background: #2c3e50; color: white; }
        .stop-btn { background: #e74c3c; color: white; display: none; } /* Hidden by default */

        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
    </style>
</head>
<body>

    <div class="header">
        <h1>ğŸ‡®ğŸ‡¹ Venice: Digital Guide</h1>
        <div class="filters-wrapper">
            <div class="scroll-container">
                <button class="btn-filter date-btn active" onclick="filterData('day', 0)">ÎŒÎ»Î±</button>
                <button class="btn-filter date-btn" onclick="filterData('day', 1)">Î”ÎµÏ… 12/1</button>
                <button class="btn-filter date-btn" onclick="filterData('day', 2)">Î¤ÏÎ¹ 13/1</button>
                <button class="btn-filter date-btn" onclick="filterData('day', 3)">Î¤ÎµÏ„ 14/1</button>
                <button class="btn-filter date-btn" onclick="filterData('day', 4)">Î ÎµÎ¼ 15/1</button>
                <button class="btn-filter date-btn" onclick="filterData('day', 5)">Î Î±Ï 16/1</button>
                <button class="btn-filter date-btn" onclick="filterData('day', 6)">Î£Î±Î² 17/1</button>
            </div>
            <div class="scroll-container">
                <button class="btn-filter active" onclick="filterData('cat', 'all')">ÎŒÎ»ÎµÏ‚ Î¿Î¹ ÎÏÎµÏ‚</button>
                <button class="btn-filter" onclick="filterData('cat', 'Ï€ÏÏ‰Î¹')">ğŸŒ… Î ÏÏ‰Î¯</button>
                <button class="btn-filter" onclick="filterData('cat', 'Î¼ÎµÏƒÎ·Î¼ÎµÏÎ¹')">ğŸ¥ª ÎœÎµÏƒÎ·Î¼Î­ÏÎ¹</button>
                <button class="btn-filter" onclick="filterData('cat', 'Î²ÏÎ±Î´Ï…')">ğŸ· Î’ÏÎ¬Î´Ï…</button>
            </div>
        </div>
    </div>

    <div class="container" id="content"></div>

    <div id="infoModal" class="modal-overlay" onclick="closeModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()"> <div class="modal-header">
                <h2 id="modalTitle" class="modal-title">Î¤Î¯Ï„Î»Î¿Ï‚</h2>
                <button class="close-btn" onclick="closeModal()">Ã—</button>
            </div>
            <div id="modalBody" class="modal-body">
                Î ÎµÏÎ¹Î³ÏÎ±Ï†Î®...
            </div>
            <div class="audio-controls">
                <button id="speakBtn" class="action-btn speak-btn" onclick="startSpeaking()">ğŸ”Š Î‘ÎºÏÏŒÎ±ÏƒÎ· ÎÎµÎ½Î±Î³Î¿Ï</button>
                <button id="stopBtn" class="action-btn stop-btn" onclick="stopSpeaking()">â¹ï¸ Î”Î¹Î±ÎºÎ¿Ï€Î®</button>
            </div>
        </div>
    </div>

    <script>
        let allData = [];
        let currentDisplayData = []; // ÎšÏÎ±Ï„Î¬Î¼Îµ Ï„Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î± Ï€Î¿Ï… Ï†Î±Î¯Î½Î¿Î½Ï„Î±Î¹ ÏƒÏ„Î·Î½ Î¿Î¸ÏŒÎ½Î·
        let currentDay = 0;
        let currentCat = 'all';
        let currentTextToSpeak = "";
        const synth = window.speechSynthesis; // Web Speech API

        // Load JSON
        fetch('locations.json')
            .then(res => res.json())
            .then(data => {
                allData = data;
                render();
            })
            .catch(err => console.error("Error loading JSON:", err));

        // Filters
        function filterData(type, value) {
            if (type === 'day') {
                currentDay = value;
                document.querySelectorAll('.date-btn').forEach(b => b.classList.remove('active'));
            } else {
                currentCat = value;
                document.querySelectorAll('.btn-filter:not(.date-btn)').forEach(b => b.classList.remove('active'));
            }
            event.target.classList.add('active');
            render();
        }

        // Render List
        function render() {
            const container = document.getElementById('content');
            container.innerHTML = '';

            // Î¦Î¹Î»Ï„ÏÎ¬ÏÎ¹ÏƒÎ¼Î±
            currentDisplayData = allData.filter(item => {
                const dayMatch = currentDay === 0 || (item.days && item.days.includes(currentDay));
                let catMatch = true;
                if (currentCat !== 'all') {
                    catMatch = item.category.toLowerCase().includes(currentCat);
                }
                return dayMatch && catMatch;
            });

            if (currentDisplayData.length === 0) {
                container.innerHTML = '<div style="text-align:center; padding:20px; color:#777;">Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎ±Î½ Î±Ï€Î¿Ï„ÎµÎ»Î­ÏƒÎ¼Î±Ï„Î±.</div>';
                return;
            }

            // Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± HTML
            currentDisplayData.forEach((item, index) => {
                container.innerHTML += `
                    <div class="card">
                        <div class="category-tag">${item.category}</div>
                        <div class="name">${item.name}</div>
                        <div class="meta-info">
                            <span class="time-badge">ğŸ•’ ${item.time || '-'}</span>
                            <span class="cost-badge">ğŸ’° ${item.cost}</span>
                        </div>
                        <div class="tip">ğŸ’¡ ${item.tip}</div>
                        
                        <div class="card-actions">
                            <button class="action-btn info-btn" onclick="openModal(${index})">â„¹ï¸ Info & Audio</button>
                            <a href="${item.mapUrl}" target="_blank" class="action-btn map-btn">ğŸ“ Î§Î¬ÏÏ„Î·Ï‚</a>
                        </div>
                    </div>
                `;
            });
        }

        // --- MODAL & AUDIO LOGIC ---

        function openModal(index) {
            // Î’ÏÎ¯ÏƒÎºÎ¿Ï…Î¼Îµ Ï„Î¿ Î±Î½Ï„Î¹ÎºÎµÎ¯Î¼ÎµÎ½Î¿ Î±Ï€ÏŒ Ï„Î· Î»Î¯ÏƒÏ„Î± Ï€Î¿Ï… Ï†Î±Î¯Î½ÎµÏ„Î±Î¹ Ï„ÏÏÎ±
            const item = currentDisplayData[index];
            
            if (!item) return;

            const title = item.name;
            // Î‘Î½ Î´ÎµÎ½ Î­Ï‡ÎµÎ¹ description, Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î¿ÏÎ¼Îµ Ï„Î¿ tip
            const text = item.description || item.tip;

            document.getElementById('modalTitle').innerText = title;
            document.getElementById('modalBody').innerText = text;
            currentTextToSpeak = text;
            
            // Show modal
            document.getElementById('infoModal').style.display = 'flex';
            
            // Reset audio buttons
            stopSpeaking();
        }

        function closeModal(event) {
            document.getElementById('infoModal').style.display = 'none';
            stopSpeaking();
        }

        function startSpeaking() {
            if (synth.speaking) {
                console.error('speechSynthesis.speaking');
                return;
            }
            if (currentTextToSpeak !== '') {
                const utterThis = new SpeechSynthesisUtterance(currentTextToSpeak);
                utterThis.lang = 'el-GR'; // Î•Î»Î»Î·Î½Î¹ÎºÎ¬
                utterThis.rate = 0.9; 

                utterThis.onend = function (event) {
                    toggleAudioButtons(false);
                }

                synth.speak(utterThis);
                toggleAudioButtons(true);
            }
        }

        function stopSpeaking() {
            if (synth.speaking) {
                synth.cancel();
            }
            toggleAudioButtons(false);
        }

        function toggleAudioButtons(isSpeaking) {
            const speakBtn = document.getElementById('speakBtn');
            const stopBtn = document.getElementById('stopBtn');
            
            if (isSpeaking) {
                speakBtn.style.display = 'none';
                stopBtn.style.display = 'inline-block';
            } else {
                speakBtn.style.display = 'inline-block';
                stopBtn.style.display = 'none';
            }
        }
    </script>

</body>
</html>
